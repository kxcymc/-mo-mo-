(()=>{var e,t={108:(e,t,r)=>{var n={"./1.jpg":658,"./10.jpg":72,"./11.jpg":205,"./12.jpg":306,"./13.jpg":687,"./14.jpg":748,"./15.jpg":793,"./16.jpg":446,"./17.jpg":907,"./18.jpg":416,"./19.jpg":933,"./2.jpg":613,"./20.jpg":809,"./21.jpg":4,"./22.jpg":715,"./23.jpg":958,"./24.jpg":805,"./25.jpg":912,"./26.jpg":668,"./3.jpg":48,"./4.jpg":355,"./5.jpg":742,"./6.jpg":353,"./7.jpg":308,"./8.jpg":167,"./9.jpg":2};function s(e){var t=o(e);return r(t)}function o(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=o,e.exports=s,s.id=108},153:(e,t,r)=>{"use strict";var n=r(836),s=r(285),o=r(889),a=r(192);function c(e){return new Date(e).toLocaleString("en-GB",{timeZone:"Asia/Shanghai",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+), (\d+):(\d+):(\d+)/,"$3-$2-$1 $4:$5:$6")}function i(){const e=document.querySelector("#navbar");e.querySelector(".aneedtoprevent").addEventListener("click",(e=>e.preventDefault()));const t=document.querySelector(".stapleFood").offsetHeight-document.querySelector(".toppings").offsetHeight,r=document.querySelector(".stapleFood").offsetHeight+document.querySelector(".toppings").offsetHeight-document.querySelector("#orderformSection").offsetHeight;console.log(r),console.log(t),window.addEventListener("scroll",(function(n){this.scrollY>=t&&this.scrollY<r?(e.style.left="auto",e.style.right="0"):(e.style.left="0",e.style.right="auto")}))}function l(){document.querySelectorAll(".count").forEach((function(e){const t=e.parentElement.querySelector("#input-number"),r=e.parentElement.querySelector("#btn-add"),n=e.parentElement.querySelector("#btn-subtract"),s=e.parentElement.querySelector(".remain"),o=parseInt(s.textContent.slice(4));r.addEventListener("click",(function(){let r=parseInt(e.textContent.slice(1));r++,r>=0?(e.textContent=`x${r}`,t.value=r,s.textContent="剩余: "+(o-r)):(e.textContent="x0",t.value=0,s.textContent=`剩余: ${o}`)})),n.addEventListener("click",(function(){let r=parseInt(e.textContent.slice(1));r--,r>=0?(e.textContent=`x${r}`,t.value=r,s.textContent="剩余: "+(o-r)):(e.textContent="x0",t.value=0,s.textContent=`剩余: ${o}`)})),t.addEventListener("blur",(function(){let r=parseInt(t.value);r>=0?(e.textContent=`x${r}`,s.textContent="剩余: "+(o-r)):(t.value=parseInt(e.textContent.slice(1)),s.textContent=`剩余: ${o}`)}))}))}function d(e){document.querySelectorAll(".count").forEach((t=>{const r=t.parentElement.querySelector(".remain");!0!==e&&(r.textContent=`剩余: ${parseInt(r.textContent.slice(4))+parseInt(t.textContent.slice(1))}`),t.textContent="x0",t.parentElement.querySelector("#input-number").value=0}))}function p(e){const t=e.length;document.querySelector(".totalOrder-count").innerHTML=`共 ${t} 单`,document.querySelector(".orderList").innerHTML=e.map((e=>{let t="",r="";switch(e.Statusid){case 1:t='<span class="badge text-bg-primary">已支付</span>',r=1;break;case 2:t='<span class="badge text-bg-secondary">正在制作</span>',r=2;break;case 3:t='<span class="badge text-bg-success">已完成</span>',r=3;break;case 4:t='<span class="badge text-bg-warning">退款成功</span>',r=4}return`<tr class="orderManageClick">\n    <td>\n      <img src="${""!==e.Foodpicture?e.Foodpicture:"https://img2.baidu.com/it/u=2640406343,1419332367&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=708&amp;h=500"}" alt="无法加载图片">\n    </td>\n    <td class='orderId'>${e.Orderid}</td>\n    <td class='orderStatus' data-status-id='${r}'>\n      ${t}\n    </td>\n    <td>\n      <span>${e.Ordertime}</span>\n    </td>\n    <td>\n      <span>${e.Totalprice}</span>\n    </td>\n    <td>\n        <i class="bi bi-x-circle fs-2">\n            <i class="bi bi-cash-coin fs-4"></i>\n        </i>\n    </td>\n    <td>\n        <i class="bi bi-trash3 del fs-2">\n            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"\n                class="bi bi-exclamation-triangle text-danger" viewBox="0 0 16 16">\n                <path\n                    d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z" />\n                <path\n                    d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z" />\n            </svg>\n        </i>\n    </td>\n  </tr>`})).join(""),function(){const e=document.querySelector("#refundModal"),t=new n.Modal(e),r=e.querySelector(".wantRefundBtn");document.querySelectorAll(".orderManageClick").forEach((e=>{e.addEventListener("click",(n=>{if(n.target.classList.contains("bi-x-circle")||n.target.classList.contains("bi-cash-coin")){const n=+e.querySelector(".orderId").innerHTML;t.show(),console.log(n),r.addEventListener("click",(async()=>{try{const r=await s.A.post("/api/userRefundOneOrder",{Orderid:n});if(200===r.status){const n=e.querySelector(".orderStatus");n.dataset.statusId="4",n.innerHTML='<span class="badge text-bg-warning">退款成功</span>',t.hide(),(0,a.xv)(!0,`${r.data.message}`)}else(0,a.xv)(!1,`${r.data.message}`),console.log("退款失败:"+r.data.message)}catch(e){console.log("后端错误:"+e)}}))}}))}))}(),function(){const e=document.querySelector("#deleteOrderModal"),t=new n.Modal(e),r=e.querySelector(".deleteOrderBtn");document.querySelectorAll(".orderManageClick").forEach((e=>{e.addEventListener("click",(n=>{if(n.target.classList.contains("bi-trash3")||n.target.classList.contains("bi-exclamation-triangle")){switch(e.querySelector(".orderStatus").dataset.statusId){case"1":case"2":return void(0,a.xv)(!1,"尚未 完成/退款 的订单无法删除!")}const n=+e.querySelector(".orderId").innerHTML;t.show(),console.log(n),r.addEventListener("click",(async()=>{try{const r=await s.A.post("/api/userUnvisitOneOrder",{Orderid:n});200===r.status?(e.remove(),t.hide(),(0,a.xv)(!0,`${r.data.message}`)):((0,a.xv)(!1,`${r.data.message}`),console.log("删除失败:"+r.data.message))}catch(e){console.log("后端错误:"+e)}}))}}))}))}()}async function u(e,t){if(!e||""!==t&&null!==t){if(t)try{const e=await s.A.post("/api/fecthOrderWithUsername",{Mytel:t});if(200===e.status){const t=e.data.totalOrder.map((e=>{const{Orderid:t,Totalprice:r,Statusid:n}=e[0],s=c(e[0].Ordertime);return{Foodpicture:document.querySelector(`div[data-food-id='${e[1].Foodid}']`).querySelector("img").src,Orderid:t,Statusid:n,Ordertime:s,Totalprice:r}}));console.log(t),p(t)}else console.log("无法获取该用户的全部订单！")}catch(e){console.log("出现错误: "+e)}}else try{const e=await s.A.post("/api/fetchlastOrderwithNULL");if(200===e.status){const t=e.data.lastOrder,{Orderid:r,Totalprice:n,Statusid:s}=t[0],o=c(t[0].Ordertime);p([{Foodpicture:document.querySelector(`div[data-food-id='${t[1].Foodid}']`).querySelector("img").src,Orderid:r,Statusid:s,Ordertime:o,Totalprice:n}])}else console.log("无法获取最新订单！")}catch(e){console.log("数据库错误: "+e)}}function g(e,t){t&&document.querySelector(".placeOrderBtn").addEventListener("click",(async t=>{if(""!==document.querySelector(".list").innerText)try{const t=await s.A.post("/api/saveOrderInfo",{orderList:e});if(200===t.status){console.log(t.data.message),document.querySelector(".list").innerHTML="",document.querySelector(".total").innerHTML="",d(!0);const r=document.querySelector(".placeOrderdiv");r&&r.remove(),console.log(e),u(!0,e[0].Mytel),document.querySelector(".alert").style.top=window.scrollY+250+"px",(0,a.xv)(!0,`${t.data.message}`)}else(0,a.xv)(!1,`${t.data.message}!`),console.log("Error:",t.data.message)}catch(e){(0,a.xv)(!1,`${e.response.data.message}!`),console.log("数据库错误: "+e)}else(0,a.xv)(!1,"您还没点菜呢～")}))}function m(e){const t=document.querySelector(".placeOrderdiv");if(e){if(!t){const t=document.createElement("div");t.className="placeOrderdiv";const r=document.createElement("button");r.className="btn placeOrderBtn btn-dark",r.textContent="下单",t.appendChild(r),document.querySelector("#orderformSection").appendChild(t),document.querySelector(".alert").style.top=window.scrollY+250+"px",(0,a.xv)(e,"好的！请下滑查看您的订单")}}else t&&t.remove(),d(),document.querySelector(".list").innerHTML="",document.querySelector(".total").innerHTML="",(0,a.xv)(e,"已清空餐品和订单，重新选择吧")}const f={navbar:i,getMenuFromServer:function(){s.A.post("/api/getFoodMenu").then((e=>{const t=e.data,n=document.querySelector(".stapleFood"),s=document.querySelector(".toppings"),o=[];for(let e=1;e<t.length+1;e++)o.push(r(108)(`./${e}.jpg`));t.forEach(((e,t)=>{const r=document.createElement("div");r.dataset.foodId=e.Foodid,r.classList.add(1===e.Cateid?"dishes":"appetizer"),r.innerHTML=`\n                <img src=${o[t]} alt="sorry">\n                <h2 class="name">${e.Food}</h2>\n                <p class="remain">剩余: ${e.Remain}</p>\n                <p class="price">¥${e.Price}</p>\n                <p class="count">x0</p>\n                <p class="btnandinput">\n                  <button class="normalbtn btn btn-sm rounded-circle" id="btn-subtract">\n                    <i class="bi bi-dash" style="font-size: 24px"></i>\n                  </button>\n                  <input type="number" id="input-number" class="form-control form-control-sm" value="0">\n                  <button class="normalbtn btn btn-sm rounded-circle" id="btn-add">\n                    <i class="bi bi-plus" style="font-size: 24px"></i>\n                  </button>\n                </p>\n              `,1===e.Cateid?n.appendChild(r):s.appendChild(r)})),i(),l()})).catch((e=>{console.error("获取菜单数据出现错误:",e)}))},buttonAddSubtract:l,buttonOkClear:function(){function e(e){const t=e.querySelector(".name").innerText,r=parseFloat(e.querySelector(".price").innerText.replace("¥","").trim()),n=parseInt(e.querySelector(".remain").innerText.replace("剩余: ","").trim()),s=parseInt(e.querySelector(".count").innerText.replace("x","").trim());return{picture:e.querySelector("img").src,Foodid:parseInt(e.dataset.foodId),Foodname:t,price:r,remainNumber:n,count:s}}document.querySelector(".clearOrderbtn").addEventListener("click",(()=>m(!1))),document.querySelector(".okOrderbtn").addEventListener("click",(async t=>{const r=document.querySelectorAll(".dishes"),n=document.querySelectorAll(".appetizer"),o=[];try{const t=await s.A.post("/api/getLastOrderID");if(200===t.status)if(console.log(t.data),console.log(t.data.message),o.push({Orderid:+t.data.lastOrderID+1,Mytel:document.querySelector(".username").innerHTML?document.querySelector(".username").innerHTML:null,Statusid:1}),r.forEach((t=>{if("0"!==t.querySelector("#input-number").value){const r=e(t);o.push(r)}})),n.forEach((t=>{if("0"!==t.querySelector("#input-number").value){const r=e(t);o.push(r)}})),1===o.length)(0,a.xv)(!1,"您没有点菜呢～");else{m(!0);const e=await function(e){return new Promise(((t,r)=>{document.querySelector(".list").innerHTML='<div class="itemheader">\n              <div class="headerpic">餐品图片</div>\n              <p class="foodname">餐品名称</p>\n              \x3c!-- <p class="foodspec">餐品规格</p> --\x3e\n              <p class="foodprice">餐品单价</p>\n              <p class="foodcount">点菜数目</p>\n              <p class="foodsub-total">小计</p>\n            </div>'+e.slice(1).map((e=>{const{picture:t,Foodname:r,count:n,price:s,spec:o,gift:a}=e,c=(100*s*n/100).toFixed(2),i=a?a.split(",").map((e=>`<span class="tag">【赠品】${e}</span> `)).join(""):"";return`\n      <div class="item">\n        <img src=${t} alt="">\n        <p class="foodname">${r} ${i} </p>\n        <p class="foodprice">${s.toFixed(2)}</p>\n        <p class="foodcount">x${n}</p>\n        <p class="foodsub-total">${c}</p>\n      </div>\n    `})).join("");const n=e.slice(1).reduce(((e,t)=>e+100*t.price*t.count/100),0);document.querySelector(".total").innerHTML=`<div style="padding:20px">合计：<span class="totalfoodamount">${n.toFixed(2)}</span></div>`,t(!0)}))}(o);console.log(o),console.log(e),o[0].Totalprice=parseFloat(document.querySelector(".totalfoodamount").innerHTML),g(o,e)}else console.log("无法取回最后一个订单编号:",t.data.message)}catch(e){console.log("数据库错误: "+e)}}))},clearSelectedFood:d,toggleOrderForm:m,axios:s.A,openAvatarImageDb:o.ru,storeAvatar:o.hH,getAvatar:o.Y0,placeanorder:g,getOrderListFromServer:function(e){const t=document.querySelector(".username").innerHTML;console.log("订单:",t),""!==t&&""!==e&&u(!1,e)},generateOrderManageDiv:u,renderOrderManageDiv:p,myAlert:a.xv,fixAlert:a.G7,utcToutc8:c},{getMenuFromServer:b,getOrderListFromServer:y,buttonOkClear:x,getAvatar:v,fixAlert:h}=f;x(),h(),b(),document.addEventListener("DOMContentLoaded",(()=>v().then((e=>{y(e)}))))},658:(e,t,r)=>{"use strict";e.exports=r.p+"assets/9e5924871a554ddb0797.jpg"},72:(e,t,r)=>{"use strict";e.exports=r.p+"assets/25967b27337f666c5021.jpg"},205:(e,t,r)=>{"use strict";e.exports=r.p+"assets/640f7d77143ce44f0ef3.jpg"},306:(e,t,r)=>{"use strict";e.exports=r.p+"assets/949e15eb37324d0c52e7.jpg"},687:(e,t,r)=>{"use strict";e.exports=r.p+"assets/175e38879713c2304630.jpg"},748:(e,t,r)=>{"use strict";e.exports=r.p+"assets/225614932c09b811bd52.jpg"},793:(e,t,r)=>{"use strict";e.exports=r.p+"assets/b97df59257d924411595.jpg"},446:(e,t,r)=>{"use strict";e.exports=r.p+"assets/272e59beabcbca8723ea.jpg"},907:(e,t,r)=>{"use strict";e.exports=r.p+"assets/889e9f7c2e2c7dcf7e87.jpg"},416:(e,t,r)=>{"use strict";e.exports=r.p+"assets/9609f6d806b79c85d108.jpg"},933:(e,t,r)=>{"use strict";e.exports=r.p+"assets/445461e2301f65e27e5c.jpg"},613:(e,t,r)=>{"use strict";e.exports=r.p+"assets/48196ba4369c76481b1c.jpg"},809:(e,t,r)=>{"use strict";e.exports=r.p+"assets/7586cc889363941f0c04.jpg"},4:(e,t,r)=>{"use strict";e.exports=r.p+"assets/1d07f572672f63e325c1.jpg"},715:(e,t,r)=>{"use strict";e.exports=r.p+"assets/d7e40a6cabdd2e390608.jpg"},958:(e,t,r)=>{"use strict";e.exports=r.p+"assets/9a103abb71a312c4e254.jpg"},805:(e,t,r)=>{"use strict";e.exports=r.p+"assets/4cd06a7012711ba55e89.jpg"},912:(e,t,r)=>{"use strict";e.exports=r.p+"assets/4d084293a2f54b1aaf61.jpg"},668:(e,t,r)=>{"use strict";e.exports=r.p+"assets/1a64cea64d35457277aa.jpg"},48:(e,t,r)=>{"use strict";e.exports=r.p+"assets/7e1a8206d2cc81cd8e4d.jpg"},355:(e,t,r)=>{"use strict";e.exports=r.p+"assets/45a3f208b5ae1eb94f41.jpg"},742:(e,t,r)=>{"use strict";e.exports=r.p+"assets/54e5f7a8917785cfe71c.jpg"},353:(e,t,r)=>{"use strict";e.exports=r.p+"assets/8d3849f7bc88d87755c4.jpg"},308:(e,t,r)=>{"use strict";e.exports=r.p+"assets/9b1c8be7899d84f7f195.jpg"},167:(e,t,r)=>{"use strict";e.exports=r.p+"assets/1d77100624b92dae2208.jpg"},2:(e,t,r)=>{"use strict";e.exports=r.p+"assets/dc44e7943a295b0927ef.jpg"}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var o=r[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.m=t,e=[],n.O=(t,r,s,o)=>{if(!r){var a=1/0;for(d=0;d<e.length;d++){for(var[r,s,o]=e[d],c=!0,i=0;i<r.length;i++)(!1&o||a>=o)&&Object.keys(n.O).every((e=>n.O[e](r[i])))?r.splice(i--,1):(c=!1,o<a&&(a=o));if(c){e.splice(d--,1);var l=s();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[r,s,o]},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=r[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e+"../"})(),(()=>{var e={709:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var s,o,[a,c,i]=r,l=0;if(a.some((t=>0!==e[t]))){for(s in c)n.o(c,s)&&(n.m[s]=c[s]);if(i)var d=i(n)}for(t&&t(r);l<a.length;l++)o=a[l],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(d)},r=self.webpackChunkrestaurant_order_manage_system=self.webpackChunkrestaurant_order_manage_system||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=n.O(void 0,[341,266],(()=>n(153)));s=n.O(s)})();