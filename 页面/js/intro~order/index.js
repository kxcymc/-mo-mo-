"use strict";(self.webpackChunkrestaurant_order_manage_system=self.webpackChunkrestaurant_order_manage_system||[]).push([[266],{192:(e,o,t)=>{function s(e,o){const t=document.querySelector(".alert");t.classList.add(e?"alert-success":"alert-danger"),t.innerHTML=o,t.classList.add("show"),setTimeout((()=>{t.classList.remove(e?"alert-success":"alert-danger"),t.innerHTML="",t.classList.remove("show")}),3e3)}function r(){window.addEventListener("scroll",function(e){let o;return function(){clearTimeout(o),o=setTimeout(e,200)}}((()=>document.querySelector(".alert").style.top=window.scrollY+50+"px")))}t.d(o,{G7:()=>r,xv:()=>s})},889:(e,o,t)=>{t.d(o,{Y0:()=>a,hH:()=>n,ru:()=>r});var s=t(285);function r(){return new Promise(((e,o)=>{const t=indexedDB.open("avatarImageDB",1);t.onupgradeneeded=e=>{const o=e.target.result;o.objectStoreNames.contains("images")||o.createObjectStore("images",{keyPath:"name"}).createIndex("isAvatar","isAvatar")},t.onsuccess=o=>{e(o.target.result)},t.onerror=()=>{o("数据库打开失败")}}))}function n(e,o){console.log(typeof e),console.log(typeof o),r().then((t=>{const s=t.transaction("images","readwrite"),r=s.objectStore("images"),n=r.index("isAvatar").get("avatar");new Promise(((e,o)=>{n.onsuccess=()=>{if(n.result){const t=r.delete(n.result.name);t.onsuccess=()=>{console.log("旧头像已删除"),e()},t.onerror=e=>{console.error("删除旧头像失败",e),o(e)}}else e()},n.onerror=e=>{console.error("查询现有头像失败",e),o(e)}})).then((()=>{const t=r.put({name:o,data:e,isAvatar:"avatar"});t.onsuccess=()=>{console.log(`头像 "${o}" 已更新/存储`)},t.onerror=()=>{console.log("存储头像失败")}})).catch((e=>{console.error("处理头像时出错",e)})),s.onerror=()=>{console.log("存储图片事务失败")}})).catch((e=>{console.log("打开数据库失败",e)}))}function a(){return new Promise(((e,o)=>{r().then((t=>{const r=t.transaction("images","readonly").objectStore("images").openCursor();r.onsuccess=async t=>{const r=t.target.result;if(r){const t=r.key;if(console.log(t),/^1\d{10}$/.test(t)){console.log(t);try{if((await s.A.post("/checkUsertel",{Mytel:t})).data.result)return document.querySelector(".myAvatar").src=r.value.data,document.querySelector(".username").innerHTML=t,console.log("Found image for mytel:",t),void e(t);console.log("找不到您，请尝试重新登录"),o("找不到用户")}catch(e){console.log("请求出错:",e),console.log(e.response?e.response.data:e),o("请求出错")}}else r.continue(),console.log("寻找下一条数据")}},r.onerror=()=>{console.log("读取图片失败"),o("读取图片失败")}})).catch((e=>{console.log(e),o("数据库打开失败")}))}))}}}]);